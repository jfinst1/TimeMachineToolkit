from cryptography.hazmat.primitives import serialization, hashes
from cryptography.hazmat.backends import default_backend
from cryptography.hazmat.primitives.asymmetric import ec

class KeyManagement:
    def save_key(self, key, filename):
        with open(filename, 'wb') as f:
            if isinstance(key, ec.EllipticCurvePrivateKey):
                f.write(key.private_bytes(
                    encoding=serialization.Encoding.PEM,
                    format=serialization.PrivateFormat.PKCS8,
                    encryption_algorithm=serialization.NoEncryption()
                ))
            elif isinstance(key, ec.EllipticCurvePublicKey):
                f.write(key.public_bytes(
                    encoding=serialization.Encoding.PEM,
                    format=serialization.PublicFormat.SubjectPublicKeyInfo
                ))

    def load_private_key(self, filename):
        with open(filename, 'rb') as f:
            return serialization.load_pem_private_key(f.read(), password=None, backend=default_backend())

    def load_public_key(self, filename):
        with open(filename, 'rb') as f:
            return serialization.load_pem_public_key(f.read(), backend=default_backend())

    def verify_key_integrity(self, key, filename):
        # Example integrity check: use a hash-based checksum
        with open(filename, 'rb') as f:
            key_data = f.read()
            digest = hashes.Hash(hashes.SHA256(), backend=default_backend())
            digest.update(key_data)
            return digest.finalize()